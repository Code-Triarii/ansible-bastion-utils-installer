- name: Check if target variable is in accepted ones
  set_fact:
    ubuntu_target: "{{ target in ['ubuntu_22_04', 'ubuntu_20_04'] }}"

- name: Get google key
  shell: |
    curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | \
    gpg --dearmor -o /usr/share/keyrings/cloud.google.gpg
  when: ubuntu_target

- name: Unzip download
  shell: |
    echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" \
    | tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
  when: ubuntu_target

- name: Update with downloaded script
  apt:
    update_cache: true
    name: google-cloud-cli
    state: present
  become: true
  when: ubuntu_target
